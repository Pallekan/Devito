<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TAXI DeVito</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../css/taxi.css">
    </head>
    <body style="background-color: white; height: 100vh; width: 100vw; overflow-x: hidden; overflow-y: hidden">
        <div id='id_customer_order_view' style="height: 100%">
            <div id="orderInfoFields" style="width: 100%; height: 30%">
                <table>
                    <tr>
                        <td>
                            <input type="text" id="orderInfoFrom" placeholder="Från"><button onclick="document.getElementById('orderInfoFrom').value = 'Pollacksbacken'">Här</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="text" id="orderInfoTo" placeholder="Till"><input id="orderInfoCount" type="number" placeholder="Antal">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span id="makeHourOptions">
                                
                            </span>
                            <span id="makeMinuteOptions">
                                
                            </span>
                            <button onclick="setNowPoint()">Nu!</button><button id="behovs_knapp" onclick="document.getElementById('behov_modal').style.display='block'"><img style="height: 5vh" alt="Failed to load icon" src="../resources/placeholder.jpg">Specialbehov</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div id= "behov_modal" class="modal">
                                <div class="specialbehov_innehåll">
                                 <span class= "close_behov" onclick="document.getElementById('behov_modal').style.display='none'"> &times;</span>   
                                 <form>
                                    <input type="checkbox" name="behov" value="Rullstol"> Rullstol<br>
                                    <input type="checkbox" name="behov" value="Barnstol"> Barnvagn<br>
                                    <input type="submit" value="Välj">
                                  </form> 
                                </div>
                             </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span id="errorNotice" style="color: red"></span>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="orderMap" style="width: 100%; height: 50%">
                The map goes here.
            </div>
            <div id="orderButtons" align="center" style="width: 100%; height: 20%;">
                <button style="alignment-baseline: central; font-size: 15vh; text-align: center; margin: auto; width: 80%; height: 90%" onclick="onlyPermitIfFilledIn(moveAndLaunch,'id_customer_order_view','id_customer_wait_view');">Beställ</button>
            </div>
        </div>
        <div id="id_customer_wait_view" style='display: none; height: 100%'>
            <div id="idTaxiInfo" style="display: none; position: absolute; height: 60%; width: 80%; top: 25%; bottom: 15%; left: 10%; right: 10%; background-color: yellow">
                <div style="background-color: white; width: 95%; height: 95%; left: 2.5%; top: 2.5%; position: absolute; text-align: left; font-size: 3vw">
                    <div style="font-size: 4vw; text-align: center">Taxiinformation</div>
                    Förare: <span id="idInfoDriver">Cave Johnson</span><br>
                    Registreringsnummer: <span id="idInfoLicense">ABC123</span><br>
                    Biltyp: <span id="idInfoType">Volvo v70</span><br>
                    Specialutrustning: <span id="idInfoSpecials">Rullstol</span><br>
                    
                </div>
            </div>
            <div id="waitTaxiTable" style="width: 100%; height: 20%; font-size: 4vh; text-align: center">
                Din taxi anländer om...<br>
                <div style="font-size: 6vh" id="taxiClockSpace"></div>
                <button id="idMoreInfoButton" style="font-size: 4vh" onclick="showTaxiDetails()">Mer information</button>
            </div>
            <div id="waitMap" style="width: 100%; height: 50%">
                The map goes here.
            </div>
            <div id="waitButtons" align="center" style="width: 100%; height: 30%;">
                <button id="idPayNow" style="alignment-baseline: central; font-size: 9vh; text-align: center; margin: auto; width: 80%; height: 65%" onclick="transition('id_customer_wait_view','id_customer_pay_view')">Betala nu</button><br>
                <span id="idPaymentDone" style="font-size: 10vh; width: 80%; height: 65%; display: none">Betalning genomförd.</span>
                <button style="alignment-baseline: central; font-size: 4vh; text-align: center; margin: auto; width: 80%; height: 25%" onclick="transition('id_customer_wait_view','id_customer_order_view'); document.getElementById('idPayNow').style.display = 'block'; document.getElementById('idPaymentDone').style.display = 'none'; clearInterval(taxiWaitCycle);">Avbryt resa</button>
            </div>
        </div>
        <div id="id_customer_pay_view" style='display: none; height: 100%'>
            <div style="width: 100%; height: 70%">
                <select onchange="summonAppropriatePayFields()" id="idPaymentSwitch">
                    <option value="Default">Välj betalningssätt</option>
                    <option value="Visa">Visa</option>
                    <option value="Mastercard">MasterCard</option>
                    <option value="Paypal">PayPal</option>
                </select>
                <div id="payFieldVisa" align="center" style="width: 100%; height: 90%; display: none">
                    Handle Visa here.
                </div>
                <div id="payFieldMastercard" align="center" style="width: 100%; height: 90%; display: none">
                    <input type="text" placeholder="card number"><br>
                    <input type="number" placeholder="CVC-code"><br>
                </div>
                <div id="payFieldPaypal" align="center" style="width: 100%; height: 90%; display: none">
                    Handle PayPal here.
                </div>
            </div>
            <div id="payButtons" align="center" style="width: 100%; height: 30%;">
                <button style="alignment-baseline: central; font-size: 9vh; text-align: center; margin: auto; width: 80%; height: 65%" onclick="transition('id_customer_pay_view','id_customer_wait_view'); document.getElementById('idPayNow').style.display = 'none'; document.getElementById('idPaymentDone').style.display = 'block';">Betala</button><br>
                <button style="alignment-baseline: central; font-size: 4vh; text-align: center; margin: auto; width: 80%; height: 25%" onclick="transition('id_customer_pay_view','id_customer_wait_view')">Avbryt betalning</button>
            </div>
        </div>
    
    <script>
        var taxiWaitCycle = null;
        function moveAndLaunch(arg1,arg2)
        {
            transition(arg1,arg2);
            startTaxiClock();
            document.getElementById('errorNotice').innerHTML = '';
        }
        function setNowPoint()
        {
            var date = new Date();
            if(date.getMinutes() > 54)
            {
                document.getElementById("orderHourOptions").value = date.getHours()+1;
                document.getElementById("orderMinuteOptions").value = "0"+(date.getMinutes()+5-60);
            }
            else
            {
                document.getElementById("orderHourOptions").value = date.getHours();
                document.getElementById("orderMinuteOptions").value = date.getMinutes()+5;
            }
        }
        function onlyPermitIfFilledIn(fun,arg1,arg2)
        {
            if(document.getElementById('orderInfoFrom').value == "")
            {
                document.getElementById("errorNotice").innerHTML = "Ogiltig avrese-plats. Vänligen skriv in en giltig upplockningsplats.";
                return;
            }
            if(document.getElementById('orderInfoTo').value == "")
            {
                document.getElementById("errorNotice").innerHTML = "Ogiltig destination. Vänligen skriv in en giltig destination.";
                return;
            }
            if(document.getElementById('orderInfoCount').value == "" || document.getElementById("orderInfoCount").value < 1)
            {
                document.getElementById("errorNotice").innerHTML = "Ogiltigt antal. Vänligen skriv in ett giltigt antal passagerare.";
                return;
            }
            var curDate = new Date();
            if(curDate.getHours() > Number(document.getElementById("orderHourOptions").value) || (curDate.getHours() == Number(document.getElementById("orderHourOptions").value) && curDate.getMinutes() > Number(document.getElementById("orderMinuteOptions").value)))
            {
                document.getElementById("errorNotice").innerHTML = "Ogiltig tid. Vänligen skriv in en giltig upplockningstid.";
                return;
            }
            fun(arg1,arg2);
        }
        function transition(from,to)
        {
            document.getElementById(from).style.display='none';
            document.getElementById(to).style.display='block';
            //if(taxiWaitCycle != null)
            //{
            //    clearInterval(taxiWaitCycle);
            //    taxiWaitCycle = null;
            //}
        }
        function showTaxiDetails()
        {
            if(document.getElementById('idTaxiInfo').style.display == 'none')
            {
                document.getElementById('idTaxiInfo').style.display='block';
                document.getElementById('idMoreInfoButton').innerHTML='Mindre information';
            }
            else
            {
                document.getElementById('idTaxiInfo').style.display='none';
                document.getElementById('idMoreInfoButton').innerHTML='Mer information';
            }
        }
        function fillTimeField(makeId,defaultText,target,maxValue)
        {
            var temp = "<select id='"+makeId+"' name='rcp'><option value='-1'>"+defaultText+"</option>";
            for (var i = 0; i <= maxValue; i++)
            {
                if(i < 10)
                {
                    temp += "<option value='"+i+"'>0"+i+"</option>";
                }
                else
                {
                    temp += "<option value='"+i+"'>"+i+"</option>";
                }
            }
            document.getElementById(target).innerHTML = temp + "</select>";
        }
        function summonAppropriatePayFields()
        {
            var id = document.getElementById("idPaymentSwitch");
            if(id != null)
            {
                document.getElementById("payFieldVisa").style.display = "none";
                document.getElementById("payFieldMastercard").style.display = "none";
                document.getElementById("payFieldPaypal").style.display = "none";
                if(id.value != "Default")
                {
                    document.getElementById("payField"+id.value).style.display = "block";
                }
            }
            //Else we have an error.
        }
        //Assumes that the fields are correctly filled in.
        function startTaxiClock()
        {
            var curDate = new Date();
            var selectedHour = document.getElementById("orderHourOptions").value;
            var selectedMinute = document.getElementById("orderMinuteOptions").value;
            console.log(selectedHour+""+selectedMinute);
            selectedHour -= curDate.getHours();
            selectedMinute -= curDate.getMinutes();
            if(selectedMinute < 0)
            {
                selectedMinute += 60;
                selectedHour--;
            }
            console.log(selectedHour+""+selectedMinute);
            document.getElementById("taxiClockSpace").innerHTML = selectedHour+":"+selectedMinute+":00";
            taxiWaitCycle = setInterval(tickTaxiClock,1000);
        }
        function tickTaxiClock()
        {
            var curClock = document.getElementById("taxiClockSpace").innerHTML.split(":");
            if(Number(curClock[2]) > 0)
            {
                curClock[2] = (Number(curClock[2])-1)+"";
                if(Number(curClock[2] < 10))
                {
                    curClock[2] = "0"+curClock[2];
                }
            }
            else
            {
                curClock[2] = "59";
                if(Number(curClock[1]) > 0)
                {
                    curClock[1] = (Number(curClock[1])-1)+"";
                    if(Number(curClock[1] < 10))
                    {
                        curClock[1] = "0"+curClock[1];
                    }
                }
                else
                {
                    curClock[1] = "59";
                    if(Number(curClock[0]) > 0)
                    {
                        curClock[0] = (Number(curClock[0])-1)+"";
                    }
                    else
                    {
                        document.getElementById("taxiClockSpace").innerHTML = "Nu"; 
                        clearInterval(taxiWaitCycle);
                        taxiWaitCycle = null;
                        return;
                    }
                }
            }
            document.getElementById("taxiClockSpace").innerHTML = curClock.join(":");
        }
        fillTimeField("orderHourOptions","Timma","makeHourOptions",23);
        fillTimeField("orderMinuteOptions","Minut","makeMinuteOptions",59);

        
    </script>
    </body>
</html>
